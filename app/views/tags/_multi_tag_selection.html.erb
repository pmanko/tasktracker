<% projects = current_user.all_viewable_projects %>
<% projects = projects.where(id: params[:project_id]) unless params[:project_id].blank? %>

<% params[:tag_names] = current_user.sticky_filters['tag_names'] if params['controller'] == 'stickies' && params['action'] == 'index' && current_user.sticky_filters['tag_names'].is_a?(Array) %>

<div class="row">
<% projects.collect{|p| p.tags.pluck(:name)}.flatten.uniq.sort.in_groups_of(6).each do |row_tags| %>

  <% row_tags.each do |tag_name| %>
    <% if tag_name %>
      <div class="col-xs-6 col-sm-4 col-md-3 col-lg-2">
        <%#= check_box_tag "tag_names[]", tag_name, (params[:tag_names] || []).include?(tag_name), class: 'tag-box' %> <%#= @tag = current_user.all_viewable_tags.find_by_name(tag_name); render partial: 'tags/show' %>
        <% @tag = current_user.all_viewable_tags.find_by_name(tag_name) %>
        <label class="checkbox tag-checkbox <%= 'tag-selected' if (params[:tag_names] || []).include?(tag_name) %>" style="margin-bottom: 0px;background-color: <%= @tag.color %>"><%= check_box_tag "tag_names[]", tag_name, (params[:tag_names] || []).include?(tag_name) %> <span class="tag-name"><%= tag_name %></span></label>
      </div>
    <% end %>
  <% end %>

<% end %>
</div>
